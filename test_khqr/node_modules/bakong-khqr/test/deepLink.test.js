const { BakongKHQR, SourceInfo } = require("../src");

const testData = [
    {
        statement: "Invalid DeepLink URL",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/deeplink",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
        ],
        errorCode: 29,
    },
    {
        statement: "Null callback source info",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
            new SourceInfo(
                "https://sit-api-bakong.nbc.gov.kh/khqr.png",
                "KHQR",
                null
            ),
        ],
        errorCode: 14,
    },
    {
        statement: "Null icon source info",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
            new SourceInfo(
                null,
                "KHQR",
                "https://sit-api-bakong.nbc.gov.kh/callback"
            ),
        ],
        errorCode: 14,
    },
    {
        statement: "Null name source info",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
            new SourceInfo(
                "https://sit-api-bakong.nbc.gov.kh/khqr.png",
                null,
                "https://sit-api-bakong.nbc.gov.kh/callback"
            ),
        ],
        errorCode: 14,
    },
    {
        statement: "Invalid QR",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF35",
        ],
        errorCode: 8,
    },
    {
        statement: "Deeplink timeout",
        data: [
            "https://fake-deeplink-api.herokuapp.com/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
        ],
        errorCode: 13,
    },
    {
        statement: "Generating DeepLink successfully",
        data: [
            "https://sit-api-bakong.nbc.gov.kh/v1/generate_deeplink_by_qr",
            "00020101021229190015john_smith@devb5204599953038405405100.05802KH5910John Smith6010Phnom Penh6304BF30",
        ],
        errorCode: null,
    },
];

process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0";

testData.forEach((data) => {
    test(data.statement, async () => {
        const decodeResponse = await BakongKHQR.generateDeepLink(
            data.data[0],
            data.data[1],
            data.data[2]
        );

        expect(decodeResponse.status.errorCode).toBe(data.errorCode);
    }, 45 * 1000);
});
